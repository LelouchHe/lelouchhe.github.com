---
layout: post
title: TDD笔记3
category: code
tag: tdd
---

## 重要的一句话

**TDD allows you...no, it requires you to make conscious design choices at all times**

以前很少思考过关于设计方面的东西,一来独立设计系统的机会很少,最多就是观摩下大牛们的设计思路,然后感叹下好美,二来是自己这方面的水平,基本还是停留在鉴赏这个阶段

但这句话给我的震撼很大

首先,设计不是某个人的工作,而是一个团队的工作.当然,前期设计或者更高层级的系统设计,还是需要有更高级别的牛人进行完工的,但对于小范围,比如服务级别或小系统级别上面,再到细化到具体代码层面上的设计,还是需要每个开发者自己來cover的

其次,设计是一项有意识的活动,是需要思考的,而人是由惰性的,所以只要能不思考,一般人是不会主动想设计的问题.TDD的主要成就在于,会"require",甚至"force"我们做有意识的设计,不论是编写test(熟悉需求),还是编写实现(代码完成),或者代码重构(设计系统),都在强迫我们主动思考这个问题.设计毕竟还不是一门工程,没有固定的算法,只有不断的一小步一小步的做起,才能有经验和感觉,才会在适当的时候做出合适的选择.而这一点,我感觉是我日后工作的一个重要方向

最后就是,"all times"的影响.设计应该是随着开发不断演化的,初期的总体设计只是为完成大部分已知确定功能而提供的设计初稿,在此基础上,通过TDD循环,不断的学习理解需求,并适应需求的变更,來完成系统的设计演化.重构,或者说重新设计,不应该作为系统开发中一个单独的过程,而是每次引入新功能,就需要完成的任务

回顾过去两年的工作,主要的精力放在了功能的实现上了,工程能力尚可,但设计这方面,没有锻炼,或者没有意识到需要锻炼,或者意识到了但不晓得如何入手,这个需要从这个角度加强了

## 渐进设计和前期设计

TDD遵循的是渐进设计风格(Incremental Design),即在TDD循环(Red/Green/Refactor)中不断的逐步推动设计的演化,力求在每个循环中都是***simple and clean**的开发设计.在重构阶段,利用test集來保证系统原有行为不会被破坏

与此对应的是前期设计风格(Up-Front Design),即将项目的某一个阶段专门拿出来,分析需求并进行系统设计

个人感觉,前期设计在TDD中也是非常重要的,对于一个从零开始的新系统,进行前期的调研,并在此基础上进行系统主体设计,是系统开发一个非常好的开始.很难想象,一个非常复杂的系统,没有任何预备,就直接开始TDD了,这就相当于徒手伐木,却忘记了磨刀之功

前期设计最大的问题,在于开发者对于前期设计的预期和本阶段和其他阶段的配合.如果开发者只是将前期设计当作设计草稿,并且利用test-before和unit test來规范开发的流程,这压根就是TDD的另一种样子.相反,如果一昧的坚持原有设计不变动,而且将测试放在了test-after和功能验收的阶段,这就成了传统的瀑布模型,那很大程度上是无法适应变动的开发过程的

TDD并不排斥前期设计,只不过前期设计只是草稿,只是手段,在开发的初期帮助我们了解需求,并提供一个可行的前进方向.比如系统基本功能点的确定,基本接口和模块交互的确定,系统分层或通信协议的确定等等,这些如果一抹黑的从下到上TDD的开发设计,一来浪费了我们开发者的经验(见多识广的开发者可能开发过类似的东西),二来琐碎的支线功能,很有可能屏蔽掉了主要功能点,三来很难完成任务的分工和团队合作

所以,前期设计是TDD的一部分,但是要记住一点,**accept that your models will almost always be wrong**.纲领性的东西,领会精神就好,把握方向,脚踏实地的前进,才是真的
